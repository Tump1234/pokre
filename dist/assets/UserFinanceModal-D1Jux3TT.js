import{K as e,u as a,j as s,L as t,G as i,M as n,N as r}from"./index-CvTZHx2e.js";import{r as c}from"./redux-vendor-nVRhWwEL.js";import{G as l,y as d}from"./ui-vendor-BXfdezGw.js";import{a as o}from"./index-B9j7S_Gp.js";import{a as u,b as m}from"./index-Cj0LOKaf.js";import{u as h}from"./6820-t6wN11A0.js";import"./react-vendor-B_uAldPx.js";function p({balance:t=0}){var i;const[n,r]=c.useState(0),[l,{isSuccess:d,isError:o,error:u}]=e(),m=localStorage.getItem("accessToken"),{data:h}=a(void 0,{skip:!m}),p=e=>e.toLocaleString("en-US").replace(/,/g," "),x=2e4;c.useEffect(()=>{var e;d&&(alert("Withdrawal created successfully!"),r(0)),o&&alert((null==(e=null==u?void 0:u.data)?void 0:e.message)||"An unknown error occurred during withdrawal.")},[d,o,u]);const v=n>t,j=n<x,N=t>=x;return s.jsxs("div",{className:"withdraw-table-container",children:[s.jsxs("div",{className:"deposit-balance-box",children:[s.jsx("div",{className:"deposit-balance-title",children:"Боломжит үлдэгдэл:"}),s.jsxs("div",{className:"deposit-balance-amount",children:[(w=null==(i=null==h?void 0:h.userBalance)?void 0:i.balance,void 0===w?"0":w.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))," ₮"]})]}),N?s.jsxs("form",{className:"withdraw-form",onSubmit:e=>{e.preventDefault(),v||j||l({amount:n,details:{}})},children:[s.jsx("input",{id:"withdraw-amount",type:"text",value:0===n||isNaN(n)?"":p(n),onFocus:()=>{0===n&&r(NaN)},onBlur:()=>{isNaN(n)&&r(0)},onChange:e=>{const a=Number(e.target.value.replace(/\s/g,""));r(a)},min:x,max:t,className:"withdraw-input "+(v||j?"input-error":""),placeholder:v?"Хэт их":j?"Хэт бага":p(x)}),s.jsx("button",{type:"submit",disabled:v||j,className:"withdraw-submit-btn",children:"Татах"})]}):s.jsx("div",{className:"withdraw-disabled-text",children:"Боломжгүй: Хамгийн бага аккаунт баланс зөрчигдсөн"})]});var w}function x({balance:e}){var t;const i=localStorage.getItem("accessToken"),{data:n}=a(void 0,{skip:!i}),r=e??(null==(t=null==n?void 0:n.userBalance)?void 0:t.balance)??0;return s.jsx(p,{balance:r})}function v(e){return l({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"},child:[]}]})(e)}function j(e){return l({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"},child:[]}]})(e)}function N(e){return l({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"},child:[]}]})(e)}function w(e){return l({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M313.6 304c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zM224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z"},child:[]}]})(e)}function b({balance:e}){var n;const r=localStorage.getItem("accessToken"),{data:l}=a(void 0,{skip:!r}),[h,{isLoading:p}]=t(),{ws:x}=c.useContext(i),[v,j]=c.useState(!1),[b,g]=c.useState(0);c.useEffect(()=>{if(!x)return;const e=e=>{try{JSON.parse(e.data).type}catch(a){}};return x.addEventListener("message",e),()=>{x.removeEventListener("message",e)}},[x]);const f=e??(null==(n=null==l?void 0:l.userBalance)?void 0:n.balance)??0;return s.jsxs("div",{className:"user-deposit-container",children:[s.jsxs("div",{className:"deposit-balance-box",children:[s.jsx("span",{className:"deposit-balance-title",children:"Боломжит үлдэгдэл:"}),s.jsxs("span",{className:"deposit-balance-amount",children:[(y=f,void 0===y?"0":y.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))," ₮"]})]}),s.jsxs("div",{className:"bank-info",children:[s.jsxs("div",{className:"bank-row",children:[s.jsx(o,{}),s.jsx("span",{children:"Банкны нэр : "}),s.jsx("span",{children:"М Банк"})]}),s.jsxs("div",{className:"bank-row account-number-wrapper",children:[s.jsx(u,{}),s.jsx("span",{children:"Bank account : "}),s.jsx("span",{className:"account-number",children:"080039008000804445"}),s.jsx("button",{onClick:()=>{navigator.clipboard.writeText("080039008000804445").then(()=>{j(!0),setTimeout(()=>j(!1),2e3)},()=>{d.error("Хуулах үед алдаа гарлаа!")})},title:"Хуулах",children:s.jsx(N,{})}),v&&s.jsx("span",{className:"tooltip",children:"Хуулсан!"})]}),s.jsxs("div",{className:"bank-row",children:[s.jsx(w,{}),s.jsx("span",{children:"Данс эзэмшигч : "}),s.jsx("span",{className:"account-number",children:"Эрдэнэтуяа Бат-Эрдэнэ"})]}),s.jsxs("div",{className:"bank-row",children:[s.jsx(m,{}),s.jsxs("span",{children:["Гүйлгээний утга хэсэгт өөрийн ",s.jsx("b",{children:"Username-ээ"})," заавал бичнэ үү."]})]})]}),s.jsx("input",{id:"deposit-amount",type:"text",value:0===b||isNaN(b)?"":(e=>e.toLocaleString("en-US").replace(/,/g," "))(b),onFocus:()=>{0===b&&g(NaN)},onBlur:()=>{isNaN(b)&&g(0)},onChange:e=>{const a=Number(e.target.value.replace(/\s/g,""));g(a)},placeholder:"Орлого хийх дүн",className:"withdraw-input"}),s.jsx("button",{className:"withdraw-submit-btn",onClick:async()=>{if(!b||b<=0)d.error("Дүн оруулна уу!");else try{await h({userId:l.userId,amount:b,type:"BANK_TRANSFER",details:{note:"User requested deposit"}}).unwrap(),d.success("Таны хүсэлт амжилттай илгээгдлээ!"),g(0)}catch(e){d.error("Алдаа гарлаа!")}},disabled:p,children:p?"Илгээж байна...":"Орлого хийх"})]});var y}const g=({history:e})=>{const[a,t]=c.useState(null);return s.jsx("div",{className:"withdraw-history-card",children:0===e.length?s.jsx("p",{className:"no-data-text",children:"No history found"}):s.jsx("div",{className:"history-list",children:e.map(e=>{const i=a===e.id;return s.jsxs("div",{className:"history-item "+(i?"expanded":""),onClick:()=>{return s=e.id,void t(a===s?null:s);var s},children:[s.jsxs("div",{className:"history-summary",children:[s.jsxs("div",{className:"summary-left",children:[e.type," - ",(c=e.amount,c.toLocaleString()),"₮"]}),s.jsx("div",{className:"summary-right",children:i?s.jsx(j,{}):s.jsx(v,{})})]}),s.jsxs("div",{className:"history-details "+(i?"expanded":""),children:[s.jsxs("p",{children:["Огноо: ",(r=e.date,new Date(r).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))]}),e.details&&s.jsxs("p",{children:["Дэлгэрэнгүй: ",e.details]}),s.jsxs("p",{children:["Төлөв: ",(n=e.status,"Complete"===n?"Батлагдсан":"Pending"===n?"Хүлээгдэж буй":n)]})]})]},e.id);var n,r,c})})})};function f({userBalance:e,closeModal:a}){const[t,i]=c.useState("withdraw"),l=h(),{data:d}=n(),{data:o}=r(),u=d||[],m=o||[],p=c.useMemo(()=>[...u.map(e=>({id:e.withdrawalId,type:"Таталт",amount:e.amount,date:e.createDate,status:e.approvedBy?"Complete":"Pending"})),...m.map(e=>({id:e.depositId,type:"Цэнэглэлт",amount:e.amount,date:e.createDate,status:"Complete"}))].sort((e,a)=>new Date(a.date).getTime()-new Date(e.date).getTime()).slice(0,5),[u,m]);return s.jsxs("div",{className:"ufm-bottom-sheet",onClick:e=>e.stopPropagation(),children:[!l&&s.jsxs("div",{className:"utf-header",children:[s.jsx("div",{className:"utf-header-icon logo"}),s.jsx("div",{className:"utf-header-name",children:"Касс"}),s.jsx("div",{className:"utf-header-icon close",onClick:a})]}),s.jsxs("div",{className:"bottom-wrapper",children:[s.jsxs("div",{className:"ufm-tabs",children:[s.jsx("div",{className:"ufm-tab "+("withdraw"===t?"active":""),onClick:()=>i("withdraw"),children:"Татах"}),s.jsx("div",{className:"ufm-tab "+("deposit"===t?"active":""),onClick:()=>i("deposit"),children:"Цэнэглэх"}),s.jsx("div",{className:"ufm-tab "+("history"===t?"active":""),onClick:()=>i("history"),children:"Түүх"})]}),s.jsx("div",{className:"ufm-content-anim",children:s.jsxs(c.Suspense,{fallback:s.jsx("div",{className:"ufm-loading",children:"Уншиж байна..."}),children:["withdraw"===t&&s.jsx(x,{balance:e},"withdraw"),"deposit"===t&&s.jsx(b,{balance:e},"deposit"),"history"===t&&s.jsx(g,{history:p})]})})]})]})}export{f as default};
