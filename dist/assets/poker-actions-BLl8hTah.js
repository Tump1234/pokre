import{j as e}from"./index-CvTZHx2e.js";import{r as t}from"./redux-vendor-nVRhWwEL.js";import n from"./ConfirmFoldModal-GS6h6PDz.js";import"./react-vendor-B_uAldPx.js";function a(e){return e>=1e6?(e/1e6).toFixed(1).replace(/\.0$/,"")+"M":e>=1e3?(e/1e3).toFixed(1).replace(/\.0$/,"")+"k":e.toString()}const s=t.memo(function({player:s,turnPlayer:l,isFolded:i,isAllIn:o,currentBet:r,currentRequiredBet:c,currentPot:u,stack:d,minRaise:m,sendAction:h,isAuto:v,gameState:x,GamePlayer:p,socketReady:b,subscribe:M}){var f;const[j,k]=t.useState(!1),[y,g]=t.useState(0),[C,P]=t.useState(!1),A=t.useRef(null),I=t.useRef(null),N=t.useMemo(()=>(null==l?void 0:l.userId)===(null==s?void 0:s.userId),[null==l?void 0:l.userId,null==s?void 0:s.userId]),R=t.useMemo(()=>Math.max(0,c-r),[c,r]),S=x.bigBlind||x.smallBlind||1,F=Math.max(m,S),B="OMAHA"===((null==(f=x.tablestate)?void 0:f.gameVariant)||"TEXAS"),E=t.useMemo(()=>{if(!B)return d;const e=u+R+R;return Math.min(d,e)},[B,u,R,d]),T=Math.min(d,R+F),D=B?E:d,L=t.useMemo(()=>"PRE_FLOP"===x.state||"FLOP"===x.state||"TURN"===x.state||"RIVER"===x.state,[x.state]),O=t.useMemo(()=>{const e={hasGamePlayer:Boolean(p),isPlayerTurn:N,notFolded:!i,notAllIn:!o,hasStack:d>0,isInBettingPhase:L,notShowdown:"SHOWDOWN"!==x.state,notTimeoutActed:!(null==p?void 0:p.isTimeoutActed),notDisconnected:!(null==p?void 0:p.isDisconnected)};return Object.values(e).every(Boolean)},[p,N,i,o,d,L,v]),G=t.useCallback((e,t)=>{b&&h(e,t)},[b,h]);t.useEffect(()=>{C||y===T||g(T)},[T,C,y]),t.useEffect(()=>{if(!C)return;const e=e=>{var t,n;const a=e.target;(null==(t=A.current)?void 0:t.contains(a))||(null==(n=I.current)?void 0:n.contains(a))||P(!1)};return document.addEventListener("click",e,{passive:!0}),()=>document.removeEventListener("click",e)},[C]);const $=t.useCallback(()=>{r>=c?k(!0):G("FOLD",0)},[r,c,G]),w=t.useCallback(()=>{const e=Math.min(d,Math.max(0,c-r));G(0===e?"CHECK":"CALL",e)},[d,c,r,G]),W=t.useCallback(()=>{if(C){let e=y;e>D&&(e=D),e<T&&e!==d&&(e=Math.min(d,T)),G("RAISE",e),P(!1)}else P(!0)},[C,y,d,T,D,G]),q=t.useMemo(()=>{const e=Math.min(d,D),t=Math.min(D,Math.max(T,R+u)),n=Math.min(D,Math.max(T,Math.floor(R+3*u/4))),a=Math.min(D,Math.max(T,Math.floor(R+u/2)));return[{label:B?"Max":"All-in",value:e},{label:"Pot",value:t},{label:"¾ Pot",value:n},{label:"½ Pot",value:a}]},[d,T,D,R,u,B]),H=t.useMemo(()=>r>=c?"Check":`Call ${a(Math.min(d,R))}`,[r,c,d,R]),z=t.useMemo(()=>y>=D&&B&&D<d?`Pot Limit ${a(y)}`:y>=d?"All in":`Raise ${a(y)}`,[y,d,D,B]),V=((null==p?void 0:p.isDisconnected)||(null==p?void 0:p.isSittingOut)||(null==p?void 0:p.isTimeoutActed))&&p&&M;return e.jsx("div",{className:"poker-actions-container",children:e.jsxs("div",{className:"poker-actions-inner",children:[V&&e.jsx("div",{className:"poker-actions-buttons",children:e.jsx("button",{className:"poker-action-button reconnect",onClick:M,children:e.jsx("span",{children:"Дахин холбогдох"})})}),!V&&O&&e.jsx("div",{ref:A,className:"raise-section "+(C?"visible":"hidden"),children:e.jsxs("div",{className:"preset-buttons-group",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:1,alignItems:"flex-end"},children:[q.map(({label:t,value:n})=>e.jsx("button",{onClick:()=>g(n),children:t},t)),e.jsx("div",{className:"raise-input-wrapper",children:e.jsx("input",{type:"number",className:"raise-input no-spin",value:0===y?"":y,min:T,max:D,onChange:e=>{const t=e.target.value,n=""===t?0:parseInt(t,10)||0,a=Math.min(D,Math.max(0,n));g(a)}})})]}),e.jsxs("div",{className:"raise-slider-wrapper",children:[e.jsx("span",{style:{fontSize:"11px",color:"rgba(255, 255, 255, 0.7)",fontWeight:600},children:a(D)}),e.jsx("input",{type:"range",className:"raise-slider",value:y,min:T,max:D,step:Math.max(1,Math.floor((D-T)/100)),onChange:e=>{const t=parseInt(e.target.value,10)||T;g(t)}}),e.jsx("span",{style:{fontSize:"11px",color:"rgba(255, 255, 255, 0.7)",fontWeight:600},children:a(T)})]})]})}),e.jsx("div",{className:"poker-actions-buttons",children:O&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"poker-action-button fold",disabled:!b,onClick:$,children:e.jsx("span",{children:"Fold"})}),e.jsx("button",{className:"poker-action-button call",disabled:!b,onClick:w,children:e.jsx("span",{children:H})}),e.jsx("button",{ref:I,className:"poker-action-button raise",disabled:!b,onClick:W,children:e.jsx("span",{children:z})})]})}),e.jsx(n,{open:j,onConfirm:()=>{G("FOLD",0),k(!1)},onCancel:()=>k(!1),title:"Та хаяхдаа итгэлтэй байна уу?",confirmText:"Тийм",cancelText:"Үгүй"})]})})},(e,t)=>{var n,a,s,l,i,o,r,c;return(null==(n=e.turnPlayer)?void 0:n.userId)===(null==(a=t.turnPlayer)?void 0:a.userId)&&(null==(s=e.player)?void 0:s.userId)===(null==(l=t.player)?void 0:l.userId)&&e.isFolded===t.isFolded&&e.isAllIn===t.isAllIn&&e.currentBet===t.currentBet&&e.currentRequiredBet===t.currentRequiredBet&&e.stack===t.stack&&e.socketReady===t.socketReady&&e.gameState.state===t.gameState.state&&(null==(i=e.GamePlayer)?void 0:i.isTimeoutActed)===(null==(o=t.GamePlayer)?void 0:o.isTimeoutActed)&&(null==(r=e.GamePlayer)?void 0:r.isDisconnected)===(null==(c=t.GamePlayer)?void 0:c.isDisconnected)});export{s as default};
