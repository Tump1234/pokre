import{I as e,J as s,a,b as r,c as o,j as t}from"./index-CvTZHx2e.js";import{E as l,r as i}from"./redux-vendor-nVRhWwEL.js";import{u as n}from"./router-vendor-BW0mZDy4.js";import"./react-vendor-B_uAldPx.js";function m({setModalType:m}){const d=n(),c=l(),[u,{data:f,isLoading:p,isError:g,error:h}]=e(),[j]=s(),[x,N]=i.useState(!1),[v,b]=i.useState({username:"",password:""}),[w,C]=i.useState(null);i.useEffect(()=>{f&&(localStorage.setItem("accessToken",f.token),c(a(!0)),j().unwrap().then(e=>{var s;c(r(e)),c(o((null==(s=e.userBalance)?void 0:s.balance)??0))}).catch(()=>{C("Failed to fetch user info after login.")}),C("Амжилттай нэвтэрлээ!"),m(""),d("/"))},[f,j,c,d,m]),i.useEffect(()=>{var e;if(g){let s="Нэвтрэхэд алдаа гарлаа. Дахин оролдоно уу!";if(h&&"data"in h&&(null==(e=h.data)?void 0:e.errorMessage)){const e=h.data.errorMessage;s={INVALID_CREDENTIALS:"Хэрэглэгчийн нэр эсвэл нууц үг буруу байна!",USER_NOT_FOUND:"Хэрэглэгч олдсонгүй!"}[e]??e}C(s)}},[g,h]);const y=e=>{let{name:s,value:a}=e.target;"username"===s&&(a=a.trim().toLowerCase()),b({...v,[s]:a})};return t.jsxs("form",{onSubmit:e=>{e.preventDefault(),u({...v,username:v.username.trim().toLowerCase()})},className:"login-form",children:[t.jsxs("div",{className:"auth-wrapper",children:[t.jsx("header",{className:"auth-header",children:"Нэвтрэх"}),t.jsx("div",{className:"auth-close",onClick:()=>m("")})]}),t.jsxs("div",{className:"login-form-fields",children:[w&&t.jsx("div",{className:"login-form-feedback",children:w}),t.jsx("div",{className:"form-field",children:t.jsx("div",{className:"login-form-item login-form-username",children:t.jsx("input",{type:"text",name:"username",placeholder:"нэр",value:v.username,onChange:y,className:"login-form-input",autoComplete:"username"})})}),t.jsx("div",{className:"form-field",children:t.jsxs("div",{className:"login-form-item login-form-password",children:[t.jsx("input",{type:x?"text":"password",name:"password",placeholder:"Нууц үг",value:v.password,onChange:y,className:"login-form-input",autoComplete:"current-password"}),t.jsx("span",{onClick:()=>N(!x),className:"login-form-toggle-password",children:x?t.jsx("div",{className:"password-toggle eye-open"}):t.jsx("div",{className:"password-toggle eye-closed"})})]})})]}),t.jsxs("div",{className:"login-form-actions",children:[t.jsx("button",{type:"submit",className:"login-form-submit",disabled:p,children:p?"Нэвтэрч байна...":"Нэвтрэх"}),t.jsx("button",{type:"submit",className:"login-form-submit",disabled:p,children:"Нууц үгээ мартсан"}),t.jsx("button",{type:"submit",className:"login-form-submit",onClick:()=>m("register"),children:"Бүртгүүлэх"}),t.jsx("button",{type:"submit",className:"login-form-submit",onClick:()=>m(""),children:"Цуцлах"})]})]})}export{m as default};
